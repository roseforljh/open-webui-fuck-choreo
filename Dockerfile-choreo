# 1. 继承官方镜像
FROM ghcr.io/open-webui/open-webui:main

# 2. 定义用户 ID
ARG USER_ID=10010
ARG GROUP_ID=10010

# 3. 关键修改：把所有需要写入数据的路径指向 /tmp
# Choreo 的根文件系统是只读的，只有 /tmp 是可写的
ENV HOME=/tmp
ENV DATA_DIR=/tmp/data

# 4. 创建用户
RUN groupadd -g $GROUP_ID choreo && \
    useradd -u $USER_ID -g $GROUP_ID -d /tmp choreo

# 5. 切换用户
USER $USER_ID

# 6. 暴露端口
EXPOSE 8080

# 7. 启动
CMD [ "bash", "start.sh" ]
